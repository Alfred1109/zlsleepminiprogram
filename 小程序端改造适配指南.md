# ğŸ”„ å°ç¨‹åºç«¯æ”¹é€ é€‚é…æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ç”±äºåç«¯éŸ³ä¹ç³»ç»Ÿè¿›è¡Œäº†ç»Ÿä¸€æ•´åˆå’Œç«¯å£å†—ä½™æ¸…ç†ï¼Œå°ç¨‹åºç«¯éœ€è¦ç›¸åº”çš„æ”¹é€ ä»¥é€‚é…æ–°çš„APIæ¥å£ã€‚æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ‰€éœ€çš„æ”¹é€ å†…å®¹å’Œè¿ç§»æ­¥éª¤ã€‚

## ğŸ¯ ä¸»è¦å˜æ›´æ¦‚è¿°

| å˜æ›´ç±»å‹ | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ |
|----------|----------|----------|
| **APIç«¯ç‚¹å˜æ›´** | éŸ³ä¹ç”Ÿæˆç›¸å…³åŠŸèƒ½ | ğŸ”´ é«˜ |
| **å‚æ•°æ ¼å¼è°ƒæ•´** | è¯·æ±‚å‚æ•°æ ‡å‡†åŒ– | ğŸŸ¡ ä¸­ |
| **å“åº”æ ¼å¼æ›´æ–°** | æ•°æ®è§£æé€»è¾‘ | ğŸŸ¡ ä¸­ |
| **ä¸‹è½½æµç¨‹å˜æ›´** | éŸ³ä¹ä¸‹è½½åŠŸèƒ½ | ğŸŸ  ä¸­é«˜ |
| **é¡µé¢è·³è½¬è°ƒæ•´** | è¯¦æƒ…é¡µè·¯ç”± | ğŸŸ¢ ä½ |

## ğŸ”„ APIç«¯ç‚¹å˜æ›´

### 1. **éŸ³ä¹ç”ŸæˆAPIæ•´åˆ**

#### âŒ **åºŸå¼ƒçš„APIç«¯ç‚¹**
```javascript
// è¿™äº›æ¥å£å·²åºŸå¼ƒï¼Œå°†è¿”å›410çŠ¶æ€ç 
POST /api/music/generate              // 60ç§’éŸ³ä¹ç”Ÿæˆ
POST /api/music/create_long_sequence  // é•¿åºåˆ—éŸ³ä¹ç”Ÿæˆ
POST /api/async-music/generate        // å¼‚æ­¥60ç§’ç”Ÿæˆ
POST /api/async-music/long-sequence/generate // å¼‚æ­¥é•¿åºåˆ—ç”Ÿæˆ
```

#### âœ… **æ–°çš„ç»Ÿä¸€APIç«¯ç‚¹**
```javascript
POST /api/music/generate-unified      // ç»Ÿä¸€éŸ³ä¹ç”Ÿæˆæ¥å£
```

### 2. **å…·ä½“æ”¹é€ ç¤ºä¾‹**

#### ğŸ”„ **60ç§’éŸ³ä¹ç”Ÿæˆæ”¹é€ **

```javascript
// âŒ æ—§ä»£ç 
wx.request({
  url: 'https://your-domain.com/api/music/generate',
  method: 'POST',
  data: {
    assessment_id: 123,
    scene_id: 1,
    music_style: 'healing'
  },
  success: (res) => {
    if (res.data.success) {
      // å¤„ç†æˆåŠŸå“åº”
      const musicId = res.data.data.music_id;
      wx.navigateTo({
        url: `/pages/music/detail?id=${musicId}&type=short`
      });
    }
  }
});

// âœ… æ–°ä»£ç 
wx.request({
  url: 'https://your-domain.com/api/music/generate-unified',
  method: 'POST',
  data: {
    assessment_id: 123,
    duration_seconds: 60,        // æ–°å¢ï¼šæ˜ç¡®æŒ‡å®šæ—¶é•¿
    scene_id: 1,
    music_style: 'healing'
  },
  success: (res) => {
    if (res.data.success) {
      // å¤„ç†æˆåŠŸå“åº”
      const musicId = res.data.data.music_id;
      wx.navigateTo({
        url: `/pages/music/detail?id=${musicId}`  // ç»Ÿä¸€è¯¦æƒ…é¡µ
      });
    }
  }
});
```

#### ğŸ”„ **é•¿åºåˆ—éŸ³ä¹ç”Ÿæˆæ”¹é€ **

```javascript
// âŒ æ—§ä»£ç 
wx.request({
  url: 'https://your-domain.com/api/music/create_long_sequence',
  method: 'POST',
  data: {
    assessment_id: 123,
    duration_minutes: 30,        // æ—§å‚æ•°
    sequence_type: 'iso_three_stage'
  },
  success: (res) => {
    if (res.data.success) {
      const sessionId = res.data.data.session_id;
      wx.navigateTo({
        url: `/pages/music/long-detail?session_id=${sessionId}`
      });
    }
  }
});

// âœ… æ–°ä»£ç   
wx.request({
  url: 'https://your-domain.com/api/music/generate-unified',
  method: 'POST',
  data: {
    assessment_id: 123,
    duration_seconds: 1800,      // æ–°å‚æ•°ï¼š30åˆ†é’Ÿ = 1800ç§’
    music_style: 'iso_three_stage'
  },
  success: (res) => {
    if (res.data.success) {
      const musicId = res.data.data.music_id;  // ç»Ÿä¸€è¿”å›music_id
      wx.navigateTo({
        url: `/pages/music/detail?id=${musicId}`  // ç»Ÿä¸€è¯¦æƒ…é¡µ
      });
    }
  }
});
```

## ğŸ“ å‚æ•°æ ¼å¼æ ‡å‡†åŒ–

### 1. **è¯·æ±‚å‚æ•°å˜æ›´**

| åŠŸèƒ½ | æ—§å‚æ•° | æ–°å‚æ•° | è¯´æ˜ |
|------|--------|--------|------|
| **æ—¶é•¿æŒ‡å®š** | `duration_minutes: 30` | `duration_seconds: 1800` | ç»Ÿä¸€ä½¿ç”¨ç§’ä¸ºå•ä½ |
| **éŸ³ä¹é£æ ¼** | `sequence_type: "iso_three_stage"` | `music_style: "iso_three_stage"` | å‚æ•°åç»Ÿä¸€ |
| **ç”¨æˆ·ID** | ä»tokenè§£æ | å¯é€‰ä¼ é€’ `user_id` | æ”¯æŒæ˜¾å¼æŒ‡å®š |

### 2. **æ–°å¢å¯é€‰å‚æ•°**

```javascript
// æ–°æ¥å£æ”¯æŒçš„å®Œæ•´å‚æ•°
{
  assessment_id: 123,           // å¿…éœ€ï¼šè¯„æµ‹ID
  duration_seconds: 60,         // å¿…éœ€ï¼šéŸ³ä¹æ—¶é•¿ï¼ˆç§’ï¼‰
  music_style: 'healing',       // å¯é€‰ï¼šéŸ³ä¹é£æ ¼
  scene_id: 1,                  // å¯é€‰ï¼šåœºæ™¯ID
  user_id: 456,                 // å¯é€‰ï¼šç”¨æˆ·IDï¼ˆé€šå¸¸ä»tokenè·å–ï¼‰
  enhanced: false               // å¯é€‰ï¼šæ˜¯å¦å¯ç”¨å¢å¼ºæ¨¡å¼
}
```

## ğŸ“Š å“åº”æ ¼å¼æ›´æ–°

### 1. **æˆåŠŸå“åº”æ ¼å¼**

```javascript
// ç»Ÿä¸€çš„æˆåŠŸå“åº”æ ¼å¼
{
  "success": true,
  "data": {
    "music_id": 123,              // ç»Ÿä¸€ä½¿ç”¨music_id
    "status": "completed",        // çŠ¶æ€ï¼šcompleted/generating/failed
    "duration_seconds": 60,       // å®é™…æ—¶é•¿
    "file_path": "/path/to/file", // æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚æœåŒæ­¥å®Œæˆï¼‰
    "task_id": "async_task_123",  // å¼‚æ­¥ä»»åŠ¡IDï¼ˆå¦‚æœå¼‚æ­¥å¤„ç†ï¼‰
    "estimated_time": 30,         // é¢„ä¼°å®Œæˆæ—¶é—´ï¼ˆç§’ï¼‰
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### 2. **é”™è¯¯å“åº”å¤„ç†**

```javascript
// æ–°å¢ï¼šåºŸå¼ƒAPIçš„é”™è¯¯å“åº”
{
  "success": false,
  "error": "æ­¤æ¥å£å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ /api/music/generate-unified",
  "deprecated": true,
  "new_endpoint": "/api/music/generate-unified",
  "migration_guide": "æ–°æ¥å£æ”¯æŒä»»æ„æ—¶é•¿éŸ³ä¹ç”Ÿæˆï¼Œå‚æ•°åŸºæœ¬å…¼å®¹"
}

// å°ç¨‹åºç«¯å¤„ç†ç¤ºä¾‹
wx.request({
  url: oldApiUrl,
  fail: (res) => {
    if (res.statusCode === 410 || res.data.deprecated) {
      // æ£€æµ‹åˆ°åºŸå¼ƒAPIï¼Œæç¤ºç”¨æˆ·å‡çº§
      wx.showModal({
        title: 'åŠŸèƒ½å‡çº§',
        content: 'éŸ³ä¹ç”ŸæˆåŠŸèƒ½å·²å‡çº§ï¼Œè¯·æ›´æ–°å°ç¨‹åºç‰ˆæœ¬è·å¾—æ›´å¥½ä½“éªŒ',
        confirmText: 'ç«‹å³æ›´æ–°',
        success: (res) => {
          if (res.confirm) {
            wx.navigateTo({
              url: '/pages/upgrade/index'
            });
          }
        }
      });
    }
  }
});
```

## ğŸµ éŸ³ä¹ä¸‹è½½æµç¨‹å˜æ›´

### 1. **ä¸‹è½½æ¥å£å‡çº§**

#### âŒ **æ—§çš„ä¸‹è½½æ–¹å¼**
```javascript
// ç›´æ¥ä¸‹è½½ï¼ˆå·²åºŸå¼ƒï¼‰
const downloadUrl = `https://your-domain.com/api/music/download/${musicId}`;
wx.downloadFile({
  url: downloadUrl,
  success: (res) => {
    // å¤„ç†ä¸‹è½½ç»“æœ
  }
});
```

#### âœ… **æ–°çš„å®‰å…¨ä¸‹è½½æ–¹å¼**
```javascript
// Step 1: è·å–å®‰å…¨ä¸‹è½½é“¾æ¥
wx.request({
  url: `https://your-domain.com/api/downloads/url/${musicId}`,
  method: 'GET',
  header: {
    'Authorization': `Bearer ${token}`
  },
  success: (res) => {
    if (res.data.success) {
      const downloadInfo = res.data.data;
      
      // Step 2: ä½¿ç”¨å®‰å…¨é“¾æ¥ä¸‹è½½
      wx.downloadFile({
        url: downloadInfo.download_url,
        success: (downloadRes) => {
          // å¤„ç†ä¸‹è½½ç»“æœ
          wx.saveFile({
            tempFilePath: downloadRes.tempFilePath,
            success: (saveRes) => {
              wx.showToast({
                title: 'ä¸‹è½½å®Œæˆ',
                icon: 'success'
              });
            }
          });
        }
      });
    }
  }
});
```

### 2. **ä¸‹è½½æƒé™æ£€æŸ¥**

```javascript
// æ–°å¢ï¼šä¸‹è½½å‰æƒé™æ£€æŸ¥
function checkDownloadPermission(musicId) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: `https://your-domain.com/api/downloads/check-permission/${musicId}`,
      header: {
        'Authorization': `Bearer ${token}`
      },
      success: (res) => {
        if (res.data.success && res.data.data.allowed) {
          resolve(res.data.data);
        } else {
          reject(res.data.data.reason || 'æ— ä¸‹è½½æƒé™');
        }
      },
      fail: reject
    });
  });
}

// ä½¿ç”¨ç¤ºä¾‹
checkDownloadPermission(musicId)
  .then(() => {
    // æ‰§è¡Œä¸‹è½½
    downloadMusic(musicId);
  })
  .catch((error) => {
    wx.showModal({
      title: 'æ— æ³•ä¸‹è½½',
      content: error,
      showCancel: false
    });
  });
```

## ğŸ”— é¡µé¢è·³è½¬è°ƒæ•´

### 1. **ç»Ÿä¸€è¯¦æƒ…é¡µè·¯ç”±**

#### âŒ **æ—§çš„é¡µé¢è·³è½¬**
```javascript
// åˆ†åˆ«è·³è½¬ä¸åŒé¡µé¢
if (musicType === 'short') {
  wx.navigateTo({
    url: `/pages/music/short-detail?id=${musicId}`
  });
} else if (musicType === 'long') {
  wx.navigateTo({
    url: `/pages/music/long-detail?session_id=${sessionId}`
  });
}
```

#### âœ… **æ–°çš„ç»Ÿä¸€è·³è½¬**
```javascript
// ç»Ÿä¸€è·³è½¬åˆ°åŒä¸€ä¸ªè¯¦æƒ…é¡µ
wx.navigateTo({
  url: `/pages/music/detail?id=${musicId}`
});
```

### 2. **è¯¦æƒ…é¡µé¢é€‚é…**

```javascript
// pages/music/detail.js
Page({
  data: {
    musicInfo: {},
    isLoading: true
  },
  
  onLoad(options) {
    const musicId = options.id;
    this.loadMusicDetail(musicId);
  },
  
  loadMusicDetail(musicId) {
    wx.request({
      url: `https://your-domain.com/api/music/detail/${musicId}`,
      success: (res) => {
        if (res.data.success) {
          const musicInfo = res.data.data;
          
          // ç»Ÿä¸€å¤„ç†ä¸åŒæ—¶é•¿çš„éŸ³ä¹
          this.setData({
            musicInfo: {
              id: musicInfo.id,
              title: this.generateTitle(musicInfo),
              duration: this.formatDuration(musicInfo.duration_seconds),
              status: musicInfo.status,
              createdAt: musicInfo.created_at,
              playUrl: musicInfo.play_url,
              downloadUrl: musicInfo.download_url,
              // æ ¹æ®æ—¶é•¿åˆ¤æ–­ç±»å‹
              type: musicInfo.duration_seconds <= 300 ? 'short' : 'long',
              typeDisplay: musicInfo.duration_seconds <= 300 ? 'å¿«é€ŸéŸ³ä¹' : 'é•¿åºåˆ—éŸ³ä¹'
            },
            isLoading: false
          });
        }
      }
    });
  },
  
  generateTitle(musicInfo) {
    const duration = Math.round(musicInfo.duration_seconds / 60);
    return `${duration}åˆ†é’Ÿç–—æ„ˆéŸ³ä¹`;
  },
  
  formatDuration(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return minutes > 0 ? `${minutes}åˆ†${remainingSeconds}ç§’` : `${seconds}ç§’`;
  }
});
```

## ğŸ› ï¸ å·¥å…·å‡½æ•°æ›´æ–°

### 1. **APIè¯·æ±‚å°è£…**

```javascript
// utils/api.js - åˆ›å»ºç»Ÿä¸€çš„APIè¯·æ±‚å·¥å…·
class MusicAPI {
  static baseUrl = 'https://your-domain.com';
  
  // ç»Ÿä¸€éŸ³ä¹ç”Ÿæˆ
  static generateMusic(params) {
    return new Promise((resolve, reject) => {
      wx.request({
        url: `${this.baseUrl}/api/music/generate-unified`,
        method: 'POST',
        data: params,
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('token')}`
        },
        success: (res) => {
          if (res.data.success) {
            resolve(res.data.data);
          } else {
            reject(new Error(res.data.error || 'è¯·æ±‚å¤±è´¥'));
          }
        },
        fail: (err) => {
          // å¤„ç†åºŸå¼ƒAPIçš„ç‰¹æ®Šæƒ…å†µ
          if (err.statusCode === 410) {
            reject(new Error('åŠŸèƒ½å·²å‡çº§ï¼Œè¯·æ›´æ–°å°ç¨‹åºç‰ˆæœ¬'));
          } else {
            reject(new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥'));
          }
        }
      });
    });
  }
  
  // å¿«é€Ÿç”Ÿæˆï¼ˆ1åˆ†é’Ÿï¼‰
  static generateQuickMusic(assessmentId, sceneId = 0) {
    return this.generateMusic({
      assessment_id: assessmentId,
      duration_seconds: 60,
      scene_id: sceneId,
      music_style: 'healing'
    });
  }
  
  // ä¸­ç­‰æ—¶é•¿ç”Ÿæˆï¼ˆ5åˆ†é’Ÿï¼‰
  static generateMediumMusic(assessmentId, sceneId = 0) {
    return this.generateMusic({
      assessment_id: assessmentId,
      duration_seconds: 300,
      scene_id: sceneId,
      music_style: 'healing'
    });
  }
  
  // é•¿åºåˆ—ç”Ÿæˆï¼ˆ30åˆ†é’Ÿï¼‰
  static generateLongMusic(assessmentId, sceneId = 0) {
    return this.generateMusic({
      assessment_id: assessmentId,
      duration_seconds: 1800,
      scene_id: sceneId,
      music_style: 'iso_three_stage'
    });
  }
  
  // è·å–å®‰å…¨ä¸‹è½½é“¾æ¥
  static getDownloadUrl(musicId, quality = 'standard') {
    return new Promise((resolve, reject) => {
      wx.request({
        url: `${this.baseUrl}/api/downloads/url/${musicId}`,
        method: 'GET',
        data: { quality },
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('token')}`
        },
        success: (res) => {
          if (res.data.success) {
            resolve(res.data.data);
          } else {
            reject(new Error(res.data.error || 'è·å–ä¸‹è½½é“¾æ¥å¤±è´¥'));
          }
        },
        fail: reject
      });
    });
  }
}

module.exports = MusicAPI;
```

### 2. **ä½¿ç”¨ç¤ºä¾‹**

```javascript
// pages/assessment/result.js
const MusicAPI = require('../../utils/api.js');

Page({
  data: {
    assessmentId: null,
    isGenerating: false
  },
  
  // ç”Ÿæˆå¿«é€ŸéŸ³ä¹
  async generateQuick() {
    try {
      this.setData({ isGenerating: true });
      
      const result = await MusicAPI.generateQuickMusic(this.data.assessmentId);
      
      wx.showToast({
        title: 'ç”ŸæˆæˆåŠŸ',
        icon: 'success'
      });
      
      // è·³è½¬åˆ°ç»Ÿä¸€è¯¦æƒ…é¡µ
      wx.navigateTo({
        url: `/pages/music/detail?id=${result.music_id}`
      });
      
    } catch (error) {
      wx.showModal({
        title: 'ç”Ÿæˆå¤±è´¥',
        content: error.message,
        showCancel: false
      });
    } finally {
      this.setData({ isGenerating: false });
    }
  },
  
  // ç”Ÿæˆé•¿åºåˆ—éŸ³ä¹
  async generateLong() {
    try {
      this.setData({ isGenerating: true });
      
      const result = await MusicAPI.generateLongMusic(this.data.assessmentId);
      
      if (result.status === 'generating') {
        // å¼‚æ­¥ç”Ÿæˆï¼Œæ˜¾ç¤ºè¿›åº¦é¡µé¢
        wx.navigateTo({
          url: `/pages/music/progress?task_id=${result.task_id}&music_id=${result.music_id}`
        });
      } else {
        // åŒæ­¥å®Œæˆï¼Œç›´æ¥è·³è½¬è¯¦æƒ…
        wx.navigateTo({
          url: `/pages/music/detail?id=${result.music_id}`
        });
      }
      
    } catch (error) {
      wx.showModal({
        title: 'ç”Ÿæˆå¤±è´¥', 
        content: error.message,
        showCancel: false
      });
    } finally {
      this.setData({ isGenerating: false });
    }
  }
});
```

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. **APIå…¼å®¹æ€§æµ‹è¯•**

```javascript
// test/api-compatibility.js
const testCases = [
  {
    name: 'å¿«é€ŸéŸ³ä¹ç”Ÿæˆ',
    api: '/api/music/generate-unified',
    data: {
      assessment_id: 1,
      duration_seconds: 60
    },
    expect: {
      success: true,
      data: {
        music_id: 'number',
        status: 'string'
      }
    }
  },
  {
    name: 'é•¿åºåˆ—éŸ³ä¹ç”Ÿæˆ',
    api: '/api/music/generate-unified', 
    data: {
      assessment_id: 1,
      duration_seconds: 1800
    },
    expect: {
      success: true,
      data: {
        music_id: 'number',
        status: 'string'
      }
    }
  }
];

// æ‰§è¡Œæµ‹è¯•
testCases.forEach(async (testCase) => {
  try {
    const result = await wx.request({
      url: baseUrl + testCase.api,
      method: 'POST',
      data: testCase.data
    });
    
    console.log(`âœ… ${testCase.name}: é€šè¿‡`);
  } catch (error) {
    console.error(`âŒ ${testCase.name}: å¤±è´¥`, error);
  }
});
```

### 2. **é”™è¯¯å¤„ç†æµ‹è¯•**

```javascript
// æµ‹è¯•åºŸå¼ƒAPIçš„å“åº”
wx.request({
  url: 'https://your-domain.com/api/music/generate', // å·²åºŸå¼ƒ
  method: 'POST',
  data: { assessment_id: 1 },
  complete: (res) => {
    if (res.statusCode === 410) {
      console.log('âœ… åºŸå¼ƒAPIæ­£ç¡®è¿”å›410çŠ¶æ€ç ');
      if (res.data.deprecated === true) {
        console.log('âœ… åºŸå¼ƒæ ‡è®°æ­£ç¡®');
      }
      if (res.data.new_endpoint) {
        console.log('âœ… æ–°ç«¯ç‚¹æŒ‡å¼•æ­£ç¡®:', res.data.new_endpoint);
      }
    }
  }
});
```

## ğŸ“… è¿ç§»æ—¶é—´è¡¨

### ğŸš€ **é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰**
- [ ] ç†Ÿæ‚‰æ–°APIæ¥å£æ–‡æ¡£
- [ ] å‡†å¤‡æµ‹è¯•ç¯å¢ƒå’Œæµ‹è¯•æ•°æ®
- [ ] åˆ›å»ºAPIå·¥å…·ç±»å’Œå…¬å…±å‡½æ•°
- [ ] è®¾è®¡é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

### ğŸ”„ **é˜¶æ®µ2ï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§»ï¼ˆ2-3å‘¨ï¼‰**
- [ ] è¿ç§»éŸ³ä¹ç”Ÿæˆç›¸å…³é¡µé¢
- [ ] æ›´æ–°è¯¦æƒ…é¡µé¢ä¸ºç»Ÿä¸€ç‰ˆæœ¬
- [ ] å®ç°æ–°çš„ä¸‹è½½æµç¨‹
- [ ] æ›´æ–°é¡µé¢è·³è½¬é€»è¾‘

### ğŸ§ª **é˜¶æ®µ3ï¼šæµ‹è¯•éªŒè¯ï¼ˆ1å‘¨ï¼‰**
- [ ] åŠŸèƒ½æµ‹è¯•ï¼šç¡®ä¿æ‰€æœ‰éŸ³ä¹ç”Ÿæˆåœºæ™¯æ­£å¸¸
- [ ] å…¼å®¹æ€§æµ‹è¯•ï¼šéªŒè¯æ–°æ—§æ¥å£åˆ‡æ¢
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå¯¹æ¯”æ–°æ—§æ¥å£æ€§èƒ½
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼šç¡®ä¿äº¤äº’æµç•…

### ğŸš€ **é˜¶æ®µ4ï¼šå‘å¸ƒä¸Šçº¿ï¼ˆ1å‘¨ï¼‰**
- [ ] å‡†å¤‡å‘å¸ƒç‰ˆæœ¬
- [ ] ç›‘æ§æ–°æ¥å£è°ƒç”¨æƒ…å†µ
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆ
- [ ] ä¿®å¤å‘ç°çš„é—®é¢˜

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **å‘åå…¼å®¹æ€§**
- åç«¯åœ¨6ä¸ªæœˆå†…ä¿æŒåºŸå¼ƒAPIçš„410å“åº”
- å°ç¨‹åºéœ€è¦åœ¨æ­¤æœŸé—´å®Œæˆè¿ç§»
- å»ºè®®å°½å¿«è¿ç§»ä»¥è·å¾—æœ€ä½³æ€§èƒ½

### 2. **é”™è¯¯å¤„ç†**
```javascript
// æ¨èçš„é”™è¯¯å¤„ç†ç­–ç•¥
function handleApiError(error, apiName) {
  if (error.statusCode === 410) {
    // åºŸå¼ƒAPIå¤„ç†
    wx.showModal({
      title: 'åŠŸèƒ½å‡çº§',
      content: 'è¯·æ›´æ–°å°ç¨‹åºåˆ°æœ€æ–°ç‰ˆæœ¬',
      confirmText: 'ç«‹å³æ›´æ–°',
      success: (res) => {
        if (res.confirm) {
          // å¼•å¯¼ç”¨æˆ·æ›´æ–°
          wx.navigateToMiniProgram({
            appId: 'your-app-id' // å¦‚æœéœ€è¦
          });
        }
      }
    });
  } else {
    // å¸¸è§„é”™è¯¯å¤„ç†
    wx.showToast({
      title: error.message || 'è¯·æ±‚å¤±è´¥',
      icon: 'none'
    });
  }
}
```

### 3. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- ä½¿ç”¨ç»Ÿä¸€çš„APIè¯·æ±‚å·¥å…·ç±»ï¼Œé¿å…é‡å¤ä»£ç 
- å®ç°è¯·æ±‚ç¼“å­˜ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚
- å¯¹äºé•¿éŸ³ä¹ç”Ÿæˆï¼Œå®ç°è½®è¯¢çŠ¶æ€æ£€æŸ¥
- ä¼˜åŒ–é¡µé¢åŠ è½½ï¼Œä½¿ç”¨å ä½ç¬¦æå‡ç”¨æˆ·ä½“éªŒ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **APIæ–‡æ¡£**ï¼šæŸ¥çœ‹æœ€æ–°çš„æ¥å£æ–‡æ¡£
- **æŠ€æœ¯ç¾¤**ï¼šåŠ å…¥å¼€å‘è€…æŠ€æœ¯äº¤æµç¾¤
- **Issueåé¦ˆ**ï¼šé€šè¿‡GitHubæˆ–å…¶ä»–æ¸ é“åé¦ˆé—®é¢˜

---

ğŸµ **é€šè¿‡è¿™æ¬¡æ”¹é€ ï¼Œå°ç¨‹åºå°†è·å¾—æ›´ç»Ÿä¸€ã€æ›´é«˜æ•ˆçš„éŸ³ä¹ç”Ÿæˆä½“éªŒï¼** âœ¨
