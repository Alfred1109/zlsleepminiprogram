<!-- pages/favorites/favorites.wxml -->
<theme-switcher 
  show-theme-switcher="{{true}}" 
  page-type="default"
  bind:themechange="onThemeChange"
/>
<view class="page-container {{themeClass}}">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">æˆ‘çš„æ”¶è—</text>
      <text class="page-subtitle">å…± {{stats.total}} é¡¹æ”¶è—</text>
    </view>
    
    <!-- å¿«æ·ç­›é€‰æŒ‰é’® -->
    <view class="header-actions">
      <view class="action-btn" bindtap="toggleFilter">
        <text class="action-icon">ğŸ”</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <view class="search-input-wrapper">
        <input
          class="search-input"
          type="text"
          placeholder="æœç´¢æ”¶è—å†…å®¹..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="clearSearch">
          <text class="clear-icon">Ã—</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view wx:if="{{showFilter}}" class="filter-panel">
    <view class="filter-overlay" bindtap="toggleFilter"></view>
    <view class="filter-content">
      <view class="filter-header">
        <text class="filter-title">ç­›é€‰ç±»å‹</text>
        <view class="filter-close" bindtap="toggleFilter">Ã—</view>
      </view>
      <view class="filter-options">
        <view 
          wx:for="{{typeOptions}}" 
          wx:key="value"
          class="filter-option {{filterType === item.value ? 'active' : ''}}"
          data-type="{{item.value}}"
          bindtap="selectFilterType"
        >
          <text class="option-icon">{{item.icon}}</text>
          <text class="option-label">{{item.label}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view wx:if="{{!isEmpty && !loading}}" class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.musicCount}}</text>
        <text class="stat-label">éŸ³ä¹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.assessmentCount}}</text>
        <text class="stat-label">è¯„æµ‹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.sequenceCount}}</text>
        <text class="stat-label">ç–—æ„ˆè„‘æ³¢</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—åˆ—è¡¨ -->
  <view class="content-section">
    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{isEmpty}}" class="empty-container">
      <view class="empty-icon">ğŸ’”</view>
      <text class="empty-title">è¿˜æ²¡æœ‰æ”¶è—</text>
      <text class="empty-subtitle">åœ¨æ’­æ”¾é¡µé¢ç‚¹å‡»çˆ±å¿ƒæ”¶è—å–œæ¬¢çš„å†…å®¹</text>
      <button class="btn-explore" bindtap="onExplore">å»æ¢ç´¢</button>
    </view>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <view wx:else class="favorites-list">
      <view 
        wx:for="{{filteredFavorites}}" 
        wx:key="id"
        class="favorite-item"
        data-item="{{item}}"
        bindtap="onItemTap"
      >
        <view class="item-cover">
          <image class="cover-image" src="{{item.cover}}" mode="aspectFill" />
          <view class="item-type-badge">
            <text class="type-icon">
              {{item.type === 'music' ? 'ğŸµ' : (item.type === 'assessment' ? 'ğŸ“Š' : 'ğŸ¼')}}
            </text>
          </view>
        </view>

        <view class="item-content">
          <view class="item-main">
            <text class="item-title">{{item.title}}</text>
            <text class="item-subtitle">{{item.subtitle}}</text>
          </view>
          
          <view class="item-meta">
            <text class="favorite-time">{{formatFavoriteTime(item.favoriteTime)}}</text>
            <text wx:if="{{item.duration}}" class="item-duration">
              {{formatDuration(item.duration)}}
            </text>
          </view>
        </view>

        <view class="item-actions">
          <view 
            class="action-btn remove-btn"
            data-item="{{item}}"
            catchtap="onRemoveFavorite"
          >
            <text class="action-icon">ğŸ’”</text>
          </view>
          <view 
            class="action-btn share-btn"
            data-item="{{item}}"
            catchtap="onShareItem"
          >
            <text class="action-icon">ğŸ“¤</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰ç»“æœæç¤º -->
  <view wx:if="{{filteredFavorites.length < favorites.length && !loading}}" class="filter-tip">
    <text class="tip-text">
      æ˜¾ç¤º {{filteredFavorites.length}} / {{favorites.length}} é¡¹
      {{searchKeyword ? 'åŒ…å«"' + searchKeyword + '"çš„' : ''}}
      {{filterType !== 'all' ? typeLabelMap[filterType] : ''}}
      æ”¶è—
    </text>
  </view>
</view>
