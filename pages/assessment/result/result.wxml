<!--pages/assessment/result/result.wxml-->
<!-- è¯„æµ‹ç»“æœé¡µé¢ -->
<!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
<theme-switcher 
  show-theme-switcher="{{true}}" 
  page-type="default"
  bind:themechange="onThemeChange"
/>
<view class="page-container page-with-tabbar {{themeClass}}">
  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ç»“æœä¸­...</view>
  </view>

  <view wx:else class="result-container">
    <!-- ç²¾ç¾çš„ç»“æœå¤´éƒ¨ -->
    <view class="result-header-new">
      <view class="header-decoration">
        <view class="decoration-circle decoration-1"></view>
        <view class="decoration-circle decoration-2"></view>
        <view class="decoration-circle decoration-3"></view>
      </view>
      <view class="success-icon">âœ¨</view>
      <view class="header-title">è¯„æµ‹å®Œæˆ</view>
      <view class="header-subtitle">ä¸ºæ‚¨ç”Ÿæˆä¸“å±ç–—æ„ˆæ–¹æ¡ˆ</view>
      <view class="completion-badge">
        <text class="badge-text">{{assessment.completed_at || 'åˆšåˆšå®Œæˆ'}}</text>
      </view>
    </view>

    <!-- è¯„æµ‹ç»“æœæ€»è§ˆå¡ç‰‡ -->
    <view wx:if="{{assessment}}" class="result-overview-card">
      <view class="overview-header">
        <view class="scale-info">
          <view class="scale-name">{{assessment.scale_name}}</view>
          <view class="scale-type">å¿ƒç†å¥åº·è¯„ä¼°</view>
        </view>
      </view>

      <!-- åˆ†æ•°å¯è§†åŒ–åŒºåŸŸ -->
      <view class="score-visualization">
        <view class="score-chart">
          <view class="score-circle-new">
            <view class="score-bg"></view>
            <view class="score-inner">
              <view class="score-number">{{assessment.total_score}}</view>
              <view class="score-total">/{{assessment.max_score || 100}}</view>
            </view>
          </view>
        </view>
        
        <view class="score-analysis">
          <view class="severity-badge severity-{{assessment.severity_level}}">
            {{getSeverityLabel(assessment.severity_level)}}
          </view>
          <view class="severity-description">{{getSeverityDescription(assessment.severity_level)}}</view>
          <view class="score-percentile">è¶…è¿‡äº†{{getScorePercentile(assessment.total_score)}}%çš„ç”¨æˆ·</view>
        </view>
      </view>
    </view>

    <!-- è¯¦ç»†åˆ†ææŠ¥å‘Š -->
    <view class="analysis-report-card">
      <view class="card-title">
        <view class="title-icon">ğŸ“Š</view>
        <text>è¯¦ç»†åˆ†ææŠ¥å‘Š</text>
      </view>
      
      <!-- è¯„æµ‹ç»´åº¦åˆ†æ -->
      <view class="dimensions-analysis">
        <view class="dimension-item" wx:for="{{assessmentDimensions}}" wx:key="name">
          <view class="dimension-header">
            <view class="dimension-name">{{item.name}}</view>
            <view class="dimension-score">{{item.score}}/{{item.maxScore}}</view>
          </view>
          <view class="dimension-bar">
            <view class="bar-bg"></view>
            <view class="bar-fill" style="width: {{(item.score / item.maxScore * 100) || 0}}%;"></view>
          </view>
          <view class="dimension-level">{{item.level}}</view>
        </view>
      </view>

      <!-- ä¸“ä¸šè§£è¯» -->
      <view class="professional-interpretation">
        <view class="interpretation-title">ä¸“ä¸šè§£è¯»</view>
        <view class="interpretation-content">
          <view class="interpretation-text">{{assessment.interpretation || getDetailedInterpretation(assessment)}}</view>
        </view>
      </view>
    </view>

    <!-- ä¸ªæ€§åŒ–å»ºè®®å¡ç‰‡ -->
    <view class="recommendations-card">
      <view class="card-title">
        <view class="title-icon">ğŸ’¡</view>
        <text>ä¸ªæ€§åŒ–å»ºè®®</text>
      </view>
      
      <view class="recommendation-list">
        <view class="recommendation-item" wx:for="{{personalizedRecommendations}}" wx:key="id">
          <view class="recommendation-icon">{{item.icon}}</view>
          <view class="recommendation-content">
            <view class="recommendation-title">{{item.title}}</view>
            <view class="recommendation-desc">{{item.description}}</view>
          </view>
          <view class="recommendation-priority priority-{{item.priority}}">{{item.priorityText}}</view>
        </view>
      </view>
    </view>

    <!-- ç–—æ„ˆéŸ³é¢‘æ–¹æ¡ˆ -->
    <view class="healing-plan-card">
      <view class="card-title">
        <view class="title-icon">ğŸµ</view>
        <text>ä¸“å±ç–—æ„ˆéŸ³é¢‘æ–¹æ¡ˆ</text>
      </view>
      
      <view class="plan-description">
        <text>åŸºäºæ‚¨çš„è¯„æµ‹ç»“æœï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èä»¥ä¸‹ç–—æ„ˆéŸ³é¢‘ç±»å‹</text>
      </view>

      <view class="music-options-new">
        <!-- 60ç§’ç–—æ„ˆéŸ³é¢‘é€‰é¡¹å·²éšè—ï¼Œä½†åŠŸèƒ½ä¿ç•™ -->

        <view class="option-card-new deep-option">
          <view class="option-header">
            <view class="option-icon">ğŸ§˜</view>
            <view class="option-badge recommended">æ¨èæ–¹æ¡ˆ</view>
          </view>
          <view class="option-content">
            <view class="option-title">30åˆ†é’Ÿæ·±åº¦ç–—æ„ˆ</view>
            <view class="option-description">å®Œæ•´çš„ISOä¸‰é˜¶æ®µç–—æ„ˆä½“éªŒï¼Œæ·±å±‚è°ƒèŠ‚</view>
            <view class="option-features">
              <text class="feature">â€¢ ç§‘å­¦ä¸‰é˜¶æ®µ</text>
              <text class="feature">â€¢ æ·±åº¦ç–—æ„ˆ</text>
              <text class="feature">â€¢ æŒç»­æ•ˆæœ</text>
            </view>
          </view>
          <view class="option-action">
            <view wx:if="{{generating && generationType === 'long'}}" class="generating-status">
              <view class="generating-spinner"></view>
              <text>ç”Ÿæˆä¸­...</text>
            </view>
            <view wx:else class="action-button deep-btn" bindtap="generateLongSequence">
              <text>å¼€å§‹ç”Ÿæˆ</text>
              <text class="btn-arrow">â†’</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç–—æ„ˆè®¡åˆ’åˆ¶å®š -->
    <view class="healing-schedule-card">
      <view class="card-title">
        <view class="title-icon">ğŸ“…</view>
        <text>å»ºè®®ç–—æ„ˆè®¡åˆ’</text>
      </view>
      
      <view class="schedule-content">
        <view class="schedule-item" wx:for="{{healingSchedule}}" wx:key="time">
          <view class="schedule-time">{{item.time}}</view>
          <view class="schedule-activity">
            <view class="activity-icon">{{item.icon}}</view>
            <view class="activity-details">
              <view class="activity-name">{{item.name}}</view>
              <view class="activity-duration">{{item.duration}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
    <view class="actions-section">
      <view class="primary-actions">
        <button class="action-btn primary-btn" bindtap="onViewMusicLibrary">
          <view class="btn-icon">ğŸ¼</view>
          <text>æ¢ç´¢éŸ³é¢‘åº“</text>
        </button>
        <button class="action-btn secondary-btn" bindtap="onRetakeAssessment">
          <view class="btn-icon">ğŸ”„</view>
          <text>é‡æ–°è¯„æµ‹</text>
        </button>
      </view>
      
      <view class="additional-actions">
        <button class="action-btn outline-btn" bindtap="onSaveReport">
          <view class="btn-icon">ğŸ’¾</view>
          <text>ä¿å­˜æŠ¥å‘Š</text>
        </button>
        <button class="action-btn outline-btn" open-type="share">
          <view class="btn-icon">ğŸ“¤</view>
          <text>åˆ†äº«ç»“æœ</text>
        </button>
        <button class="action-btn outline-btn" open-type="timeline">
          <view class="btn-icon">ğŸŒ</view>
          <text>æœ‹å‹åœˆ</text>
        </button>
      </view>
    </view>

    <!-- æ¸©é¦¨æç¤ºå’Œä¸“ä¸šå»ºè®® -->
    <view class="tips-section-new">
      <view class="tips-header">
        <view class="tips-icon">ğŸ’¡</view>
        <view class="tips-title">æ¸©é¦¨æç¤º</view>
      </view>
      
      <view class="tips-content">
        <view class="tip-category">
          <view class="tip-category-title">ğŸ§ è†å¬å»ºè®®</view>
          <view class="tip-item">â€¢ é€‰æ‹©å®‰é™èˆ’é€‚çš„ç¯å¢ƒï¼Œé¿å…å¤–ç•Œå¹²æ‰°</view>
          <view class="tip-item">â€¢ ä½¿ç”¨é«˜è´¨é‡è€³æœºï¼Œè·å¾—æœ€ä½³éŸ³è´¨ä½“éªŒ</view>
          <view class="tip-item">â€¢ å»ºè®®é—­çœ¼è†å¬ï¼Œä¸“æ³¨äºéŸ³é¢‘å¸¦æ¥çš„æ„Ÿå—</view>
        </view>
        
        <view class="tip-category">
          <view class="tip-category-title">â° æ—¶é—´å®‰æ’</view>
          <view class="tip-item">â€¢ æ¯æ—¥å›ºå®šæ—¶é—´è†å¬ï¼Œå…»æˆç–—æ„ˆä¹ æƒ¯</view>
          <view class="tip-item">â€¢ ç¡å‰30åˆ†é’Ÿæ˜¯æœ€ä½³ç–—æ„ˆæ—¶é—´</view>
          <view class="tip-item">â€¢ å‹åŠ›å¤§æ—¶å¯éšæ—¶è¿›è¡ŒçŸ­æ—¶ç–—æ„ˆ</view>
        </view>
        
        <view class="tip-category disclaimer">
          <view class="tip-category-title">âš ï¸ é‡è¦æé†’</view>
          <view class="tip-item">â€¢ æœ¬è¯„æµ‹ç»“æœä»…ä¾›å¿ƒç†å¥åº·å‚è€ƒ</view>
          <view class="tip-item">â€¢ å¦‚æœ‰ä¸¥é‡å¿ƒç†é—®é¢˜ï¼Œè¯·åŠæ—¶å’¨è¯¢ä¸“ä¸šåŒ»ç”Ÿ</view>
          <view class="tip-item">â€¢ ç–—æ„ˆæ˜¯è¾…åŠ©æ‰‹æ®µï¼Œä¸å¯æ›¿ä»£ä¸“ä¸šæ²»ç–—</view>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{generating}}" class="generating-overlay">
    <view class="generating-content">
      <view class="generating-spinner"></view>
      <view class="generating-title">æ­£åœ¨ç”Ÿæˆ30åˆ†é’Ÿç–—æ„ˆéŸ³é¢‘...</view>
      <view class="generating-subtitle">åŸºäºæ‚¨çš„è¯„æµ‹ç»“æœï¼ŒAIæ­£åœ¨ä¸ºæ‚¨å®šåˆ¶ä¸“å±éŸ³é¢‘</view>
    </view>
  </view>
  </view>
</view>

<!-- å…¨å±€åº•éƒ¨èœå•æ  -->
<global-tabbar 
  id="globalTabbar"
  current-page="assessment"
  theme-class="{{themeClass}}"
  visible="{{true}}"
/>