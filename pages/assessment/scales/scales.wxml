<!--pages/assessment/scales/scales.wxml-->
<!-- 评测量表选择页面 -->
<view class="page-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">心理评测</view>
    <view class="page-subtitle">了解您的心理状态，获得个性化疗愈</view>
  </view>

  <!-- 场景状态指示器 -->
  <view wx:if="{{isInSceneMode}}" class="scene-indicator">
    <view class="scene-indicator-content">
      <view class="scene-indicator-icon">🎯</view>
      <view class="scene-indicator-text">
        <text class="scene-indicator-title">{{sceneHint}}</text>
        <text class="scene-indicator-subtitle">只显示相关评测量表</text>
      </view>
      <view class="scene-indicator-action" bindtap="exitSceneMode">
        <text class="exit-text">退出</text>
      </view>
    </view>
  </view>

  <!-- 页面内容 -->
  <view class="page-content">
    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <view class="loading-text">加载评测量表中...</view>
    </view>

    <!-- 评测量表列表 -->
    <view wx:else>
      <view class="content-section">
        <view class="section-header">
          <view class="section-title">选择评测量表</view>
          <view wx:if="{{isInSceneMode}}" class="section-subtitle">
            共 {{filteredScales.length}} 个相关量表
          </view>
        </view>

        <!-- 量表列表 -->
        <view wx:if="{{filteredScales.length > 0}}" class="list-container">
          <view
            wx:for="{{filteredScales}}"
            wx:key="id"
            class="list-item"
            data-scale="{{item}}"
            bindtap="onStartAssessment"
          >
            <view class="list-item-icon">{{item.icon}}</view>
            <view class="list-item-content">
              <view class="list-item-title">{{item.name}}</view>
              <view class="list-item-subtitle">{{item.scale_type}}</view>
              <view class="card-content">{{item.description}}</view>
              <view class="list-item-meta">
                ⏱️ {{item.estimatedTime}} · 📝 {{item.question_count}}题
              </view>
            </view>
            <view class="list-item-action">
              <text style="color: #5D9E7E; font-size: 24rpx;">▶</text>
            </view>
          </view>
        </view>

        <!-- 空状态 -->
        <view wx:else class="empty-state">
          <view class="empty-icon">📋</view>
          <view class="empty-title">
            {{isInSceneMode ? '暂无相关评测量表' : '暂无评测量表'}}
          </view>
          <view class="empty-subtitle">
            {{isInSceneMode ? '当前场景暂无对应的评测量表' : '请稍后重试或联系客服'}}
          </view>
          <view wx:if="{{isInSceneMode}}" class="empty-action">
            <button class="empty-button" bindtap="exitSceneMode">查看所有量表</button>
          </view>
        </view>
      </view>

      <!-- 最近评测 -->
      <view wx:if="{{recentAssessments.length > 0}}" class="content-section">
        <view class="section-header">
          <view class="section-title">最近评测</view>
          <view class="section-action" bindtap="onViewHistory">查看全部</view>
        </view>

        <view class="list-container">
          <view
            wx:for="{{recentAssessments}}"
            wx:key="id"
            class="recent-item"
            data-assessment="{{item}}"
            bindtap="onViewResult"
          >
            <view class="recent-icon">
              <view class="recent-scale-icon">{{item.scale_icon || '📋'}}</view>
            </view>
            <view class="recent-content">
              <view class="recent-name">{{item.scale_name}}</view>
              <view class="recent-score">得分: {{item.total_score}}</view>
              <view class="recent-time">{{item.completed_at}}</view>
            </view>
            <view class="recent-status">
              <view class="status-badge status-{{item.severity_level}}">
                {{item.severity_level}}
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 评测说明 -->
      <view class="content-section">
        <view class="section-header">
          <view class="section-title">评测说明</view>
        </view>

        <view class="card">
          <view class="info-content">
            <view class="info-item">📋 请在安静的环境中完成评测</view>
            <view class="info-item">🎯 根据最近一周的感受如实作答</view>
            <view class="info-item">⚠️ 评测结果仅供参考，不作为诊断依据</view>
            <view class="info-item">🎵 完成评测后可生成个性化疗愈音乐</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
