<!-- pages/index/index.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-icon"></view>
      <input placeholder="æœç´¢è‡ªç„¶å£°éŸ³ã€å†¥æƒ³éŸ³ä¹..." bindconfirm="onSearch" />
    </view>
  </view>



  <!-- å®æ—¶éŸ³ä¹æ³¢å½¢åŒºåŸŸ -->
  <view class="brainwave-section {{isPlaying ? 'playing' : ''}}">
    <!-- æ³¢å½¢å¯è§†åŒ–å®¹å™¨ -->
    <view class="waveform-container">
      <static-waveform 
        isPlaying="{{isPlaying}}"
        progress="{{playProgress}}"
        theme="healing"
        barCount="{{80}}"
        duration="{{currentSound.duration || 180}}"
        musicId="{{currentSound.id || playingSoundId}}"
        musicName="{{currentSound.name || currentSound.title}}"
        musicType="{{currentSound.category || currentSound.type}}"
        bind:seek="onWaveformSeek"
      />
    </view>
    
    <!-- å½“å‰éŸ³ä¹çŠ¶æ€æ˜¾ç¤º -->
    <view class="wave-info">
      <view class="wave-info-item">
        <text class="info-label">æ­£åœ¨æ’­æ”¾:</text>
        <text class="info-value">{{currentSound.name || currentSound.title || (isPlaying ? 'ç–—æ„ˆ' : 'æš‚æ— éŸ³ä¹')}}</text>
      </view>
      <view class="wave-info-item">
        <text class="info-label">éŸ³ä¹ç±»å‹:</text>
        <text class="info-value">{{currentSound.category || 'ç–—æ„ˆéŸ³ä¹'}}</text>
      </view>
      <view class="wave-info-item">
        <text class="info-label">æ’­æ”¾çŠ¶æ€:</text>
        <text class="info-value">{{isPlaying ? 'æ’­æ”¾ä¸­' : 'å¾…æœº'}}</text>
      </view>
    </view>
  </view>

  <!-- å£°éŸ³åˆ†ç±» -->
  <view class="section-header">
    <text class="section-title">å£°éŸ³åˆ†ç±»</text>
    <view class="section-actions">
      <view class="refresh-btn" bindtap="forceRefreshCategories">ğŸ”„</view>
      <view class="section-more" bindtap="showAllCategories">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
  </view>
  
  <!-- ä¸‰ä¸ªåˆ†ç±»ä¸€æ’å¸ƒå±€ -->
  <view class="sound-categories">
    <view wx:for="{{categories}}" wx:key="id" 
          class="sound-category-item {{selectedCategory === item.id ? 'selected' : ''}}" 
          bindtap="onCategoryTap" 
          data-id="{{item.id}}"
          data-name="{{item.name}}"
          data-index="{{index}}">
      <view class="sound-category-icon category-icon-{{item.id}}">
        <text class="category-emoji">{{item.icon || 'ğŸµ'}}</text>
      </view>
      <text>{{item.name || 'æœªçŸ¥åˆ†ç±»'}}</text>
      <text class="category-count" wx:if="{{item.count > 0}}">{{item.count}}é¦–</text>
    </view>
  </view>



  <!-- åˆ†ç±»æ¨èéŸ³é¢‘åŒºåŸŸ -->
  <view class="category-recommendations" wx:if="{{selectedCategory && categoryRecommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">{{getCategoryName(selectedCategory)}} Â· æ¨è</text>
    </view>
    
    <!-- å‚ç›´æ’åˆ—çš„æ¨èåˆ—è¡¨ -->
    <view class="recommendations-vertical-list">
      <view wx:for="{{categoryRecommendations}}" wx:key="id" wx:if="{{index < 3}}"
            class="recommendation-vertical-item {{playingSoundId === item.id ? 'playing' : ''}}"
            bindtap="onRecommendationTap"
            data-music="{{item}}">
        
        <!-- éŸ³é¢‘å°é¢ -->
        <view class="music-cover-vertical">
          <image 
            class="cover-image-vertical" 
            src="{{item.image || '/images/default-music-cover.svg'}}" 
            mode="aspectFill"
          />
        </view>
        
        <!-- éŸ³é¢‘ä¿¡æ¯ -->
        <view class="music-info-vertical">
          <text class="music-title-vertical">{{item.title}}</text>
          <text class="music-duration-vertical" wx:if="{{item.duration}}">{{formatDuration(item.duration)}}</text>
        </view>
        
        <!-- æ’­æ”¾æŒ‰é’® -->
        <view class="play-button-vertical" 
              catchtap="onPlayRecommendation" 
              data-music="{{item}}">
          <text class="play-icon-vertical">â–¶</text>
        </view>
      </view>
    </view>
  </view>



  <!-- ä½¿ç”¨æç¤º -->
  <view class="usage-tip" wx:if="{{!selectedCategory}}">
    <view class="tip-icon">ğŸ’¡</view>
    <view class="tip-content">
      <text class="tip-title">å¼€å§‹æ‚¨çš„ç–—æ„ˆä¹‹æ—…</text>
      <text class="tip-desc">é€‰æ‹©ä¸€ä¸ªåˆ†ç±»ï¼ŒæŸ¥çœ‹æ¨èéŸ³é¢‘å¹¶å¼€å§‹æ’­æ”¾</text>
    </view>
  </view>
</view>

<!-- ç»Ÿä¸€åº•éƒ¨æ’­æ”¾å™¨ -->
<global-player 
  id="globalPlayer"
  visible="{{showGlobalPlayer}}"
  bind:playStateChange="onGlobalPlayerStateChange"
  bind:nextTrack="onNextTrack"
  bind:previousTrack="onPreviousTrack"
  bind:closePlayer="onCloseGlobalPlayer"
  bind:expandPlayer="onExpandGlobalPlayer"
/>
