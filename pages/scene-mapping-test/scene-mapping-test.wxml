<!--pages/scene-mapping-test/scene-mapping-test.wxml-->
<!-- 场景映射测试页面 -->
<view class="page-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">🧪 场景映射API测试</view>
    <view class="page-subtitle">测试动态映射功能是否正常工作</view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button 
      class="btn-primary" 
      bindtap="onRetestTap" 
      loading="{{loading}}"
      disabled="{{loading}}"
    >
      {{loading ? '测试中...' : '重新测试'}}
    </button>
    
    <button class="btn-secondary" bindtap="onClearCacheTap">
      清除缓存
    </button>
    
    <button 
      class="btn-secondary" 
      bindtap="onCopyDebugTap"
      wx:if="{{debugInfo}}"
    >
      复制调试信息
    </button>
  </view>

  <!-- 测试结果 -->
  <view class="test-results">
    <view class="results-header">
      <text class="results-title">测试结果</text>
      <text class="results-count">{{testResults.length}} 条记录</text>
    </view>
    
    <view class="results-content">
      <view 
        wx:for="{{testResults}}" 
        wx:key="index" 
        class="result-item {{item.includes('❌') ? 'error' : item.includes('✅') ? 'success' : item.includes('⚠️') ? 'warning' : ''}}"
      >
        <text class="result-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 映射数据展示 -->
  <view wx:if="{{mappings}}" class="mappings-display">
    <view class="section-title">📊 映射数据结构</view>
    <view class="mappings-content">
      <text class="mappings-text">{{mappings}}</text>
    </view>
  </view>

  <!-- 调试信息 -->
  <view wx:if="{{debugInfo}}" class="debug-info">
    <view class="section-title">🔍 缓存调试信息</view>
    <view class="debug-content">
      <view class="debug-item">
        <text class="debug-label">缓存状态:</text>
        <text class="debug-value">{{debugInfo.hasCachedMappings ? '有缓存' : '无缓存'}}</text>
      </view>
      <view class="debug-item">
        <text class="debug-label">缓存有效性:</text>
        <text class="debug-value">{{debugInfo.cacheValid ? '有效' : '无效'}}</text>
      </view>
      <view class="debug-item">
        <text class="debug-label">缓存年龄:</text>
        <text class="debug-value">{{debugInfo.cacheAge ? debugInfo.cacheAge + 'ms' : 'N/A'}}</text>
      </view>
      <view class="debug-item">
        <text class="debug-label">最后获取时间:</text>
        <text class="debug-value">{{debugInfo.lastFetchTime ? debugInfo.lastFetchTime : 'N/A'}}</text>
      </view>
    </view>
  </view>

  <!-- 说明文档 -->
  <view class="help-section">
    <view class="section-title">📖 测试说明</view>
    <view class="help-content">
      <view class="help-item">
        <text class="help-title">测试1: 直接调用后端API</text>
        <text class="help-desc">测试 /scene/mappings 等API接口是否正常响应</text>
      </view>
      <view class="help-item">
        <text class="help-title">测试2: 场景映射服务</text>
        <text class="help-desc">测试映射服务的各个方法是否正常工作</text>
      </view>
      <view class="help-item">
        <text class="help-title">测试3: 具体场景匹配</text>
        <text class="help-desc">测试量表和音乐的场景匹配逻辑</text>
      </view>
      <view class="help-item">
        <text class="help-title">测试4: 缓存系统</text>
        <text class="help-desc">测试缓存的存储、清除和重建功能</text>
      </view>
    </view>
  </view>
</view>
