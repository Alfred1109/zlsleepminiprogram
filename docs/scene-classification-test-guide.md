# 场景分类系统测试指南

## 概述

本文档用于测试新实现的场景分类系统，确保用户可以通过场景入口和底部菜单入口获得不同的体验。

## 测试准备

### 前提条件
1. 确保小程序已登录用户账户
2. 确保用户有已完成的评测记录（不同量表类型）
3. 确保用户有已生成的脑波数据

### 测试数据
- 睡眠场景 (scaleType: 'PSQI')
- 抑郁场景 (scaleType: 'HAMD-17') 
- 焦虑场景 (scaleType: 'GAD-7')
- 专注场景 (scaleType: null)

## 测试流程

### 1. 场景分类导航测试

#### 1.1 从首页进入场景
**步骤：**
1. 打开小程序首页
2. 点击任意场景卡片（如：睡眠场景）
3. 进入场景详情页面

**预期结果：**
- 成功跳转到场景详情页面
- 页面标题显示为场景名称
- 显示该场景相关的评测历史和脑波历史

#### 1.2 从场景页面进入评测
**步骤：**
1. 在场景详情页面点击"开始评测"
2. 跳转到评测页面

**预期结果：**
- 评测页面顶部显示场景指示器
- 指示器显示："当前在「场景名称」场景模式下"
- 只显示与该场景对应的评测量表
- 标签页显示过滤后的数量（如：共 1 个相关量表）

#### 1.3 从场景页面进入脑波库
**步骤：**
1. 在场景详情页面点击"立即生成"
2. 跳转到脑波生成页面，或点击底部"脑波"标签
3. 进入脑波库页面

**预期结果：**
- 脑波库页面顶部显示场景指示器
- 指示器显示："当前在「场景名称」场景模式下"
- 只显示与该场景相关的脑波数据
- 标签页显示过滤后的数量

### 2. 底部菜单导航测试

#### 2.1 直接从底部菜单进入评测
**步骤：**
1. 点击底部导航栏的"评测"选项
2. 进入评测页面

**预期结果：**
- 评测页面不显示场景指示器
- 显示所有可用的评测量表
- 没有任何过滤限制

#### 2.2 直接从底部菜单进入脑波库
**步骤：**
1. 点击底部导航栏的"脑波"选项
2. 进入脑波库页面

**预期结果：**
- 脑波库页面不显示场景指示器
- 显示所有用户的脑波数据
- 没有任何过滤限制

### 3. 场景模式切换测试

#### 3.1 退出场景模式
**步骤：**
1. 在场景模式下的评测或脑波页面
2. 点击场景指示器中的"退出"按钮
3. 确认退出场景模式

**预期结果：**
- 显示确认对话框
- 确认后场景指示器消失
- 显示所有数据，无过滤限制
- 显示"已退出场景模式"提示

#### 3.2 场景模式状态保持
**步骤：**
1. 从场景进入评测页面（场景模式）
2. 切换到其他底部标签页
3. 再切换回评测页面

**预期结果：**
- 场景模式状态保持
- 仍显示场景指示器
- 仍显示过滤后的数据

### 4. 空状态处理测试

#### 4.1 场景模式下无匹配数据
**步骤：**
1. 进入一个没有对应数据的场景模式
2. 查看评测或脑波页面

**预期结果：**
- 显示特殊的空状态界面
- 提示："当前场景暂无相关[评测量表/脑波]"
- 提供"查看全部"和"生成/评测"两个按钮

#### 4.2 访客模式处理
**步骤：**
1. 未登录状态下访问相关页面

**预期结果：**
- 显示登录引导
- 不受场景模式影响

### 5. 数据过滤准确性测试

#### 5.1 量表类型匹配测试
**步骤：**
1. 进入睡眠场景（PSQI）
2. 检查评测页面显示的量表

**预期结果：**
- 只显示PSQI相关的量表
- 不显示HAMD-17、GAD-7等其他量表

#### 5.2 脑波数据匹配测试
**步骤：**
1. 进入抑郁场景（HAMD-17）
2. 检查脑波库显示的数据

**预期结果：**
- 只显示基于HAMD-17评测生成的脑波
- 不显示其他评测类型生成的脑波

### 6. 场景上下文管理测试

#### 6.1 上下文过期测试
**步骤：**
1. 等待24小时（或调整代码中的过期时间进行测试）
2. 重新打开小程序

**预期结果：**
- 过期的场景上下文自动清除
- 不再显示场景模式

#### 6.2 上下文恢复测试
**步骤：**
1. 进入场景模式
2. 关闭小程序
3. 重新打开小程序

**预期结果：**
- 场景模式状态正确恢复
- 继续显示场景指示器和过滤数据

## 测试检查表

### 功能完整性检查
- [ ] 场景指示器正确显示
- [ ] 数据过滤准确工作
- [ ] 退出场景模式功能正常
- [ ] 空状态处理正确
- [ ] 上下文管理正常

### 用户体验检查
- [ ] 导航流程清晰直观
- [ ] 场景模式提示明确
- [ ] 过滤状态反馈及时
- [ ] 错误状态处理友好
- [ ] 性能表现良好

### 界面一致性检查
- [ ] 场景指示器样式统一
- [ ] 空状态界面设计一致
- [ ] 按钮样式和交互一致
- [ ] 颜色主题协调
- [ ] 字体大小合适

## 已知问题和限制

### 当前实现限制
1. 脑波数据的场景匹配基于评测量表类型，如果脑波数据没有明确的量表关联，可能无法正确过滤
2. 场景上下文24小时后自动过期，可能需要根据实际使用情况调整
3. 目前只支持基于量表类型的过滤，未来可能需要更复杂的匹配逻辑

### 潜在改进点
1. 增加更细粒度的场景分类
2. 支持自定义场景过滤规则
3. 添加场景使用统计和推荐
4. 优化场景模式的视觉指示

## 测试结果记录

### 测试环境
- 小程序版本：
- 测试设备：
- 测试时间：
- 测试人员：

### 测试结果
- [ ] 所有测试通过
- [ ] 部分测试失败（详见问题记录）
- [ ] 需要进一步优化

### 问题记录
（在此记录测试过程中发现的问题）

### 优化建议
（在此记录测试过程中的优化建议）
