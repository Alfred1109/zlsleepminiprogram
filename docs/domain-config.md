# 小程序域名配置指南

## 生产环境配置

### 需要在小程序管理后台配置的域名白名单

#### 1. request合法域名
- `https://medsleep.cn` - 主API服务器（通过Nginx反向代理到5000端口）

#### 2. downloadFile合法域名
- `https://medsleep.cn` - 静态资源下载（通过Nginx反向代理到5000端口）

#### 3. uploadFile合法域名
- `https://medsleep.cn` - 文件上传（通过Nginx反向代理到5000端口）

#### 4. socket合法域名
- `wss://medsleep.cn` - WebSocket连接（通过Nginx反向代理到5000端口）

## 端口配置说明

### 常见端口配置：
- **443端口**：标准HTTPS端口，可以省略不写
- **5000端口**：常见的开发/生产服务器端口
- **80端口**：标准HTTP端口（不推荐，小程序要求HTTPS）

### 配置示例：
**当前配置（推荐）** - 使用443端口HTTPS：
```
https://medsleep.cn
wss://medsleep.cn
```

**说明**：您的后端服务在443端口提供HTTPS服务，这是标准的HTTPS端口。

## 配置步骤

1. 登录微信小程序管理后台
2. 进入"开发" -> "开发管理" -> "开发设置"
3. 在"服务器域名"部分配置上述域名（根据您的实际端口选择）
4. 确保所有域名都使用HTTPS协议
5. 保存配置

## 注意事项

- 域名必须经过ICP备案
- 必须使用HTTPS协议
- 域名不能使用IP地址
- 配置后需要重新发布小程序才能生效
- 开发工具中可以勾选"不校验合法域名"进行本地调试
- **重要**：请根据您的实际服务器端口配置相应的域名

## 环境切换

- **本地开发环境**：使用本地IP地址（127.0.0.1:5000）
- **真机调试环境**：自动使用生产服务器（medsleep.cn:5000）
- **测试环境**：使用 medsleep.cn:5000
- **生产环境**：使用 medsleep.cn:5000

### 环境检测逻辑
- 开发工具中：使用本地服务器
- 真机调试：自动切换到生产服务器
- 体验版/正式版：使用生产服务器

## 相关配置文件

- `utils/config.js` - 环境配置
- `app.json` - 网络超时配置
- `utils/api.js` - API请求配置

## 七牛云配置

七牛云CDN域名已更新为支持HTTPS的域名：
- `https://cdn.medsleep.cn` - 音频文件CDN（支持HTTPS）

## 验证配置

配置完成后，可以通过以下方式验证：
1. 在开发工具中测试API连接
2. 检查网络请求是否成功
3. 确认音频文件能正常加载
