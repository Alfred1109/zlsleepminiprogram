# 统一环境配置方案

## 📋 概述

为了解决真机调试、本地调试、审核版本和正式版本之间的环境不一致问题，我们实施了统一环境配置方案。

## 🎯 核心原则

**所有环境使用相同的服务器地址，确保100%一致性**

无论是本地开发、真机调试、体验版还是正式版，都连接同一个生产服务器，避免任何环境差异导致的连接错误。

## 🔧 统一配置

### 服务器地址（所有环境相同）
- **API服务器**: `https://medsleep.cn/api`
- **静态资源**: `https://medsleep.cn`
- **CDN服务器**: `https://cdn.medsleep.cn`

### 网络配置（所有环境相同）
- **超时时间**: 15秒
- **重试次数**: 3次
- **IP检测**: 关闭
- **设备白名单**: 关闭（简化配置）

### 环境差异（仅调试级别不同）
- **DEVELOPMENT**: DEBUG=true, LOG_LEVEL=debug
- **PRODUCTION**: DEBUG=false, LOG_LEVEL=error  
- **TEST**: DEBUG=true, LOG_LEVEL=info
- **LOCAL**: DEBUG=true, LOG_LEVEL=debug

## 🚀 环境检测逻辑

```javascript
// 根据 envVersion 和平台自动检测环境
if (envVersion === 'release') {
  → PRODUCTION 环境（正式版）
} else if (envVersion === 'trial') {
  → TEST 环境（体验版）
} else {
  if (platform === 'devtools') {
    → LOCAL 环境（开发工具）
  } else {
    → DEVELOPMENT 环境（真机调试）
  }
}
```

## ✅ 解决的问题

1. **真机调试正常，本地调试错误** ✅ 已解决
2. **审核版本可能使用错误的环境** ✅ 已解决
3. **不同环境配置不一致** ✅ 已解决
4. **开发和生产环境切换复杂** ✅ 已解决

## 🎉 使用效果

- **开发效率提升**: 无需关心环境切换
- **调试一致性**: 所有调试方式使用相同服务器
- **审核保障**: 无论审核时检测到什么环境都不会出错
- **维护简化**: 只需维护一套服务器配置

## 📝 微信小程序后台配置

确保在微信小程序管理后台配置以下域名：

**request合法域名**:
- `https://medsleep.cn`

**downloadFile合法域名**:
- `https://medsleep.cn`
- `https://cdn.medsleep.cn`

## 🔄 版本历史

- **v1.0** (最初版本): 不同环境使用不同服务器地址
- **v2.0** (当前版本): 统一环境配置，所有环境使用相同服务器

## 🎯 最佳实践

1. **统一性优先**: 保持所有环境的配置一致
2. **简化配置**: 避免复杂的环境切换逻辑
3. **生产就绪**: 所有环境都连接生产服务器，确保稳定性
4. **调试友好**: 保留必要的调试信息输出

---

*这个统一配置方案确保了小程序在任何环境下都能正常工作，无论是开发、调试还是上架审核。*
