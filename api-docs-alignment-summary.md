# åç«¯æ¥å£æ–‡æ¡£å¯¹é½ä¿®æ”¹æ€»ç»“æŠ¥å‘Š

## ğŸ¯ ä¿®æ”¹ç›®æ ‡
æ ¹æ®æœ€æ–°çš„åç«¯æ¥å£æ–‡æ¡£ `API_INTERFACE_DOCS.md`ï¼Œç»Ÿä¸€å‰ç«¯æ¥å£è°ƒç”¨å’Œå­—æ®µå‘½åï¼Œç¡®ä¿å‰åç«¯å®Œå…¨å¯¹é½ã€‚

## âœ… å®Œæˆçš„ä¸»è¦ä¿®æ”¹

### 1. ğŸš¨ ç§»é™¤åºŸå¼ƒæ¥å£è°ƒç”¨

#### å·²åºŸå¼ƒçš„æ¥å£
- `âŒ GET /api/scene/{scene_id}/scale-types` (404)
- `âŒ GET /api/scene/{scene_id}/music-types` (404)

#### ä¿®æ”¹çš„æ–‡ä»¶
**`utils/healingApi.js`**
- âœ… å°†åºŸå¼ƒæ¥å£æ ‡è®°ä¸º `@deprecated`
- âœ… æ·»åŠ è­¦å‘Šæ—¥å¿—ï¼Œå¼•å¯¼å¼€å‘è€…ä½¿ç”¨æ–°æ¥å£
- âœ… è‡ªåŠ¨è½¬å‘åˆ°æ–°çš„ç»Ÿä¸€æ¥å£ `getSceneDetail()`

**`pages/scene-mapping-test/scene-mapping-test.js`**
- âœ… æ›´æ–°æµ‹è¯•é€»è¾‘ï¼Œä½¿ç”¨æ–°çš„ç»Ÿä¸€åœºæ™¯æ¥å£
- âœ… æ·»åŠ åºŸå¼ƒæ¥å£æµ‹è¯•ï¼ˆéªŒè¯æ˜¯å¦æ­£ç¡®è¿”å›404ï¼‰
- âœ… æµ‹è¯•åœºæ™¯ä»£ç è°ƒç”¨ï¼š`/api/scene/sleep`

### 2. ğŸ”„ æ–°å¢å¯¹æ–°å­—æ®µç»“æ„çš„æ”¯æŒ

#### æ–°çš„å“åº”å­—æ®µç»“æ„
æ ¹æ®æ–‡æ¡£ï¼Œæ–°çš„åœºæ™¯è¯¦æƒ…APIè¿”å›ï¼š
```json
{
  "assessment_scales": [
    {
      "scale_id": 1,
      "scale_name": "æ±‰å¯†å°”é¡¿æŠ‘éƒé‡è¡¨-17é¡¹",
      "scale_type": "international"
    }
  ],
  "music_categories": [
    {
      "category_id": 1,
      "category_name": "åŠ©çœ ç–—æ„ˆ",
      "category_code": "natural_sound"
    }
  ]
}
```

#### ä¿®æ”¹çš„æ–‡ä»¶
**`utils/sceneMappingService.js`**
- âœ… æ–°å¢ `getSceneDetail()` æ–¹æ³•æ”¯æŒ
- âœ… åœ¨ `isMusicMatchingScene()` ä¸­ä¼˜å…ˆä½¿ç”¨æ–°çš„ `music_categories` å­—æ®µ
- âœ… æ”¯æŒæ–°çš„éŸ³ä¹åˆ†ç±»å­—æ®µï¼š`category_name`, `category_code`
- âœ… æ›´æ–°éŸ³ä¹ç±»å‹æå–é€»è¾‘ï¼Œä¼˜å…ˆä½¿ç”¨æ–°å­—æ®µ

**`utils/dataMapper.js`**
- âœ… æ›´æ–° `CategoryMapper`ï¼Œæ”¯æŒæ–°çš„åˆ†ç±»å­—æ®µç»“æ„
- âœ… æ·»åŠ å­—æ®µæ˜ å°„ï¼š`category_id`, `category_name`, `category_code`
- âœ… æ–°å¢ `toBackend()` æ–¹æ³•ï¼Œæ”¯æŒå‰ç«¯åˆ°åç«¯çš„æ•°æ®è½¬æ¢

**`pages/index/index.js`**
- âœ… æ›´æ–°éŸ³ä¹å¤„ç†é€»è¾‘ï¼Œæ”¯æŒæ–°çš„åˆ†ç±»å­—æ®µ
- âœ… æ·»åŠ å¯¹ `category_name` å’Œ `category_code` çš„æ”¯æŒ

### 3. ğŸ”— ç»Ÿä¸€APIè·¯å¾„

#### æ–°çš„ç»Ÿä¸€æ¥å£è·¯å¾„
- âœ… `/api/scene/list` - è·å–åœºæ™¯åˆ—è¡¨
- âœ… `/api/scene/{scene_code}` - è·å–åœºæ™¯è¯¦æƒ…ï¼ˆæ”¯æŒä»£ç ï¼‰
- âœ… `/api/scene/{scene_id}` - è·å–åœºæ™¯è¯¦æƒ…ï¼ˆæ”¯æŒIDï¼‰
- âœ… `/api/scene/mappings` - è·å–æ˜ å°„å…³ç³»ï¼ˆå…¼å®¹ï¼‰

#### ä¿®æ”¹çš„æ–‡ä»¶
**`utils/healingApi.js`**
- âœ… æ›´æ–° `getMappings()` ä¼˜å…ˆä½¿ç”¨ `/api/scene/mappings`
- âœ… æ–°å¢ `getSceneDetail()` ç»Ÿä¸€æ¥å£æ–¹æ³•
- âœ… æ”¯æŒæŸ¥è¯¢å‚æ•°ï¼š`include`, `format`

**`utils/sceneMappingService.js`**
- âœ… ä¼˜å…ˆå°è¯• `/api/scene/list` è·å–åœºæ™¯åˆ—è¡¨
- âœ… æ·»åŠ APIè·¯å¾„å›é€€æœºåˆ¶ï¼Œä¿æŒå…¼å®¹æ€§
- âœ… æ–°å¢ `convertNewFormatToMappings()` è½¬æ¢æ–¹æ³•

### 4. âœ… å­—æ®µåå®Œå…¨å¯¹é½

#### é‡è¡¨ç›¸å…³å­—æ®µï¼ˆå·²å®Œæˆï¼‰
| æ–‡æ¡£å­—æ®µ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| `scale_id` | âœ… å·²ç»Ÿä¸€ | é‡è¡¨ID |
| `scale_name` | âœ… å·²ç»Ÿä¸€ | é‡è¡¨åç§° |
| `scale_type` | âœ… å·²ç»Ÿä¸€ | é‡è¡¨ç±»å‹ |

#### éŸ³ä¹åˆ†ç±»ç›¸å…³å­—æ®µï¼ˆæ–°å¢ï¼‰
| æ–‡æ¡£å­—æ®µ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| `category_id` | âœ… å·²æ”¯æŒ | éŸ³ä¹åˆ†ç±»ID |
| `category_name` | âœ… å·²æ”¯æŒ | éŸ³ä¹åˆ†ç±»åç§° |
| `category_code` | âœ… å·²æ”¯æŒ | éŸ³ä¹åˆ†ç±»ä»£ç  |

#### åœºæ™¯åŸºç¡€å­—æ®µï¼ˆä¿æŒä¸€è‡´ï¼‰
| æ–‡æ¡£å­—æ®µ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| `id` | âœ… å·²å¯¹é½ | åœºæ™¯ID |
| `code` | âœ… å·²å¯¹é½ | åœºæ™¯ä»£ç  |
| `name` | âœ… å·²å¯¹é½ | åœºæ™¯åç§° |
| `description` | âœ… å·²å¯¹é½ | åœºæ™¯æè¿° |

### 5. ğŸ›¡ï¸ å…¼å®¹æ€§ä¿éšœ

#### æ¸è¿›å¼è¿ç§»ç­–ç•¥
- âœ… **æ–°æ—§æ¥å£å¹¶å­˜**ï¼šä¼˜å…ˆä½¿ç”¨æ–°æ¥å£ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æ—§æ¥å£
- âœ… **å­—æ®µåå…¼å®¹**ï¼šåŒæ—¶æ”¯æŒæ–°æ—§å­—æ®µåï¼Œä¼˜å…ˆä½¿ç”¨æ–°å­—æ®µ
- âœ… **è­¦å‘Šæç¤º**ï¼šä½¿ç”¨åºŸå¼ƒæ¥å£æ—¶è¾“å‡ºè­¦å‘Šæ—¥å¿—
- âœ… **æ•°æ®è½¬æ¢**ï¼šæ–°æ—§æ•°æ®æ ¼å¼è‡ªåŠ¨è½¬æ¢

#### é”™è¯¯å¤„ç†æœºåˆ¶
```javascript
// ç¤ºä¾‹ï¼šè‡ªåŠ¨å›é€€æœºåˆ¶
return get('/api/scene/mappings').catch(() => {
  console.warn('âš ï¸ æ–°æ¥å£ä¸å¯ç”¨ï¼Œä½¿ç”¨æ—§æ¥å£')
  return get('/scene/mappings')
})
```

## ğŸ“‹ ä¿®æ”¹ç»Ÿè®¡

### ä¿®æ”¹æ–‡ä»¶æ¸…å•
1. `utils/healingApi.js` - APIæ¥å£å®šä¹‰æ›´æ–°
2. `utils/sceneMappingService.js` - åœºæ™¯æ˜ å°„æœåŠ¡æ›´æ–°
3. `utils/dataMapper.js` - æ•°æ®æ˜ å°„å™¨æ›´æ–°
4. `pages/scene-mapping-test/scene-mapping-test.js` - æµ‹è¯•é¡µé¢æ›´æ–°
5. `pages/index/index.js` - é¦–é¡µé€»è¾‘æ›´æ–°

### ä»£ç è¡Œæ•°ç»Ÿè®¡
- **æ–°å¢ä»£ç **: ~150è¡Œ
- **ä¿®æ”¹ä»£ç **: ~80è¡Œ
- **åˆ é™¤ä»£ç **: ~30è¡Œï¼ˆä¸»è¦æ˜¯ç®€åŒ–çš„å›é€€é€»è¾‘ï¼‰

## ğŸ” éªŒè¯ç»“æœ

### APIè°ƒç”¨éªŒè¯
- âœ… æ–°çš„ç»Ÿä¸€æ¥å£è°ƒç”¨æ­£å¸¸
- âœ… åºŸå¼ƒæ¥å£æ­£ç¡®è¿”å›è­¦å‘Š
- âœ… å…¼å®¹æ€§å›é€€æœºåˆ¶å·¥ä½œæ­£å¸¸

### å­—æ®µåéªŒè¯
- âœ… æ‰€æœ‰é‡è¡¨å­—æ®µä½¿ç”¨ `scale_*` æ ¼å¼
- âœ… æ‰€æœ‰éŸ³ä¹åˆ†ç±»å­—æ®µä½¿ç”¨ `category_*` æ ¼å¼
- âœ… åœºæ™¯åŸºç¡€å­—æ®µä¸æ–‡æ¡£å®Œå…¨å¯¹é½

### åŠŸèƒ½éªŒè¯
- âœ… åœºæ™¯æ˜ å°„åŠŸèƒ½æ­£å¸¸
- âœ… éŸ³ä¹åˆ†ç±»è¿‡æ»¤æ­£å¸¸
- âœ… è¯„æµ‹é‡è¡¨è¿‡æ»¤æ­£å¸¸

## ğŸ¯ æ–°APIä½¿ç”¨ç¤ºä¾‹

### è·å–åœºæ™¯è¯¦æƒ…
```javascript
// ä½¿ç”¨åœºæ™¯ä»£ç 
const response = await SceneMappingAPI.getSceneDetail('sleep_therapy')

// ä½¿ç”¨åœºæ™¯ID  
const response = await SceneMappingAPI.getSceneDetail(1)

// å¸¦æŸ¥è¯¢å‚æ•°
const response = await SceneMappingAPI.getSceneDetail('sleep', {
  include: 'scales',
  format: 'simple'
})
```

### å¤„ç†æ–°çš„å“åº”æ ¼å¼
```javascript
const { assessment_scales, music_categories } = response.data

// å¤„ç†è¯„æµ‹é‡è¡¨
assessment_scales.forEach(scale => {
  console.log(`é‡è¡¨: ${scale.scale_name} (ID: ${scale.scale_id})`)
  console.log(`ç±»å‹: ${scale.scale_type}`)
})

// å¤„ç†éŸ³ä¹åˆ†ç±»
music_categories.forEach(category => {
  console.log(`éŸ³ä¹: ${category.category_name} (${category.category_code})`)
  console.log(`ä¸»è¦åˆ†ç±»: ${category.is_primary}`)
})
```

## ğŸ”® åç»­å»ºè®®

### 1. å®Œå…¨è¿ç§»åˆ°æ–°æ¥å£
- ç›‘æ§æ–°æ¥å£ä½¿ç”¨æƒ…å†µ
- é€æ­¥ç§»é™¤æ—§æ¥å£çš„å…¼å®¹ä»£ç 
- æ›´æ–°APIæ–‡æ¡£å’Œå¼€å‘æŒ‡å—

### 2. æ€§èƒ½ä¼˜åŒ–
- åˆ©ç”¨æ–°æ¥å£çš„æŸ¥è¯¢å‚æ•°æŒ‰éœ€è·å–æ•°æ®
- å®ç°æ›´ç»†ç²’åº¦çš„ç¼“å­˜ç­–ç•¥
- å‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“

### 3. ç±»å‹å®šä¹‰
```typescript
// å»ºè®®æ·»åŠ TypeScriptç±»å‹å®šä¹‰
interface SceneDetail {
  id: number
  code: string
  name: string
  assessment_scales: AssessmentScale[]
  music_categories: MusicCategory[]
}

interface AssessmentScale {
  scale_id: number
  scale_name: string
  scale_type: string
  weight: number
  is_primary: boolean
}

interface MusicCategory {
  category_id: number
  category_name: string
  category_code: string
  weight: number
  is_primary: boolean
}
```

## ğŸ‰ ä¿®æ”¹æ€»ç»“

âœ… **å…¨é¢å¯¹é½**ï¼šå‰ç«¯æ¥å£è°ƒç”¨ä¸åç«¯æ–‡æ¡£å®Œå…¨å¯¹é½
âœ… **å­—æ®µç»Ÿä¸€**ï¼šæ‰€æœ‰å­—æ®µåç§°ä¸æ–‡æ¡£æ ‡å‡†ä¸€è‡´  
âœ… **å…¼å®¹æ€§å¼º**ï¼šæ–°æ—§æ¥å£å¹³æ»‘è¿‡æ¸¡ï¼Œé›¶å½±å“ä¸Šçº¿
âœ… **æ‰©å±•æ€§å¥½**ï¼šæ”¯æŒæ–°çš„ `music_categories` å’Œ `assessment_scales` å­—æ®µ
âœ… **ä»£ç è´¨é‡**ï¼šæ— lintingé”™è¯¯ï¼Œä»£ç ç»“æ„æ¸…æ™°

ç°åœ¨å°ç¨‹åºçš„æ¥å£ä½¿ç”¨å·²ç»ä¸åç«¯æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼Œä¸ºåç»­çš„åŠŸèƒ½å¼€å‘å’Œç»´æŠ¤å¥ å®šäº†åšå®çš„åŸºç¡€ï¼
